import{_ as U,r as h,c as j,a as i,o as l,b as e,d as b,w as M,e as A,u as S,f as J,g as Y,v as se,h as x,t as y,F as N,i as B,n as w,j as W,H as D,k as ve,p as he,l as ye,m as xe,q as K,s as Z,x as be,y as P,z as oe,A as ne,T as _e,D as ee,B as ke,C as we,E as $e,G as Ce,I as Se,J as Me}from"./frappe-ui-qnzYlFgN.js";import{m as te}from"./markdown-EYEEs2_F.js";import{l as Ae}from"./socket-LzvdsN3v.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const g of n)if(g.type==="childList")for(const d of g.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function u(n){const g={};return n.integrity&&(g.integrity=n.integrity),n.referrerPolicy&&(g.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?g.credentials="include":n.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function c(n){if(n.ep)return;n.ep=!0;const g=u(n);fetch(n.href,g)}})();async function C(s,o={}){var n;const u=await fetch("/api/method/"+s,{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":((n=window.frappe)==null?void 0:n.csrf_token)||""},body:JSON.stringify(o)});if(!u.ok){const g=await u.json().catch(()=>({}));throw new Error(g.exception||g.message||`API call failed: ${u.status}`)}return(await u.json()).message}const H={createSession:s=>C("frappe_deep_agents.api.create_session",{agent_definition:s}),getSession:s=>C("frappe_deep_agents.api.get_session",{session_id:s}),sendMessage:(s,o)=>C("frappe_deep_agents.api.send_message",{session_id:s,message:o}),endSession:s=>C("frappe_deep_agents.api.end_session",{session_id:s}),listAgents:()=>C("frappe_deep_agents.api.list_agents"),listSessions:(s=null,o=null)=>C("frappe_deep_agents.api.list_sessions",{agent_definition:s,status:o}),updateTodo:(s,o)=>C("frappe_deep_agents.api.update_todo",{todo_name:s,status:o}),getFileContent:s=>C("frappe_deep_agents.api.get_file_content",{file_name:s}),exportAgentYaml:s=>C("frappe_deep_agents.api.export_agent_yaml",{agent_definition:s}),importAgentYaml:s=>C("frappe_deep_agents.api.import_agent_yaml",{yaml_content:s})},je={class:"session-sidebar flex flex-col h-full bg-gray-50 border-r border-gray-200"},Te={class:"p-3 border-b border-gray-200"},Le={class:"p-3 border-b border-gray-200"},Ie={class:"relative"},Ne={class:"flex-1 overflow-y-auto"},Be={key:0,class:"p-4 text-center text-gray-500 text-sm"},Fe=["onClick"],De={class:"flex items-start justify-between"},He={class:"flex-1 min-w-0"},Oe={class:"font-medium text-sm truncate text-gray-900"},ze={class:"text-xs text-gray-500 mt-1 flex items-center space-x-2"},Ve={__name:"SessionSidebar",props:{sessions:{type:Array,default:()=>[]},currentSession:{type:Object,default:null}},emits:["new-session","select-session"],setup(s){const o=s,u=h(""),c=j(()=>{if(!u.value)return o.sessions;const m=u.value.toLowerCase();return o.sessions.filter(a=>{const r=(a.agent_definition||"").toLowerCase(),p=(a.name||"").toLowerCase();return r.includes(m)||p.includes(m)})}),n=m=>o.currentSession&&o.currentSession.name===m.name,g=m=>{if(!m)return"";const a=new Date(m),p=new Date-a,$=Math.floor(p/6e4),F=Math.floor(p/36e5),I=Math.floor(p/864e5);return $<1?"Just now":$<60?`${$}m ago`:F<24?`${F}h ago`:I<7?`${I}d ago`:a.toLocaleDateString("en-US",{month:"short",day:"numeric"})},d=m=>({active:"Active",completed:"Done",error:"Error",timeout:"Timeout"})[m==null?void 0:m.toLowerCase()]||m||"Active",v=m=>({active:"green",completed:"blue",error:"red",timeout:"orange"})[m==null?void 0:m.toLowerCase()]||"gray";return(m,a)=>(l(),i("div",je,[e("div",Te,[b(S(J),{variant:"solid",onClick:a[0]||(a[0]=r=>m.$emit("new-session")),class:"w-full"},{prefix:M(()=>[...a[2]||(a[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])]),default:M(()=>[a[3]||(a[3]=A(" New Chat ",-1))]),_:1})]),e("div",Le,[e("div",Ie,[a[4]||(a[4]=e("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),Y(e("input",{"onUpdate:modelValue":a[1]||(a[1]=r=>u.value=r),placeholder:"Search sessions...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white"},null,512),[[se,u.value]])])]),e("div",Ne,[c.value.length===0?(l(),i("div",Be,y(u.value?"No sessions found":"No sessions yet"),1)):x("",!0),(l(!0),i(N,null,B(c.value,r=>(l(),i("div",{key:r.name,class:w(["session-item p-3 cursor-pointer hover:bg-gray-100 transition-colors border-b border-gray-100",n(r)?"bg-blue-50 border-l-4 border-l-blue-500":"border-l-4 border-l-transparent"]),onClick:p=>m.$emit("select-session",r.name)},[e("div",De,[e("div",He,[e("div",Oe,y(r.agent_definition||"Agent Session"),1),e("div",ze,[e("span",null,y(g(r.creation)),1)])]),b(S(W),{label:d(r.status),theme:v(r.status),size:"sm"},null,8,["label","theme"])])],10,Fe))),128))])]))}},Ee=U(Ve,[["__scopeId","data-v-ed06ff8e"]]),Pe={class:"message-role text-xs font-semibold mb-1 opacity-75"},Ue=["innerHTML"],Je={key:0,class:"typing-indicator mt-2"},We={key:1,class:"text-xs opacity-50 mt-2"},Re={__name:"ChatMessage",props:{message:{type:Object,required:!0}},setup(s){D.registerLanguage("javascript",ve),D.registerLanguage("python",he),D.registerLanguage("bash",ye),D.registerLanguage("json",xe);const o=s;te.setOptions({breaks:!0,gfm:!0,highlight:function(d,v){if(v&&D.getLanguage(v))try{return D.highlight(d,{language:v}).value}catch(m){console.error("Highlight error:",m)}return d}});const u=j(()=>{if(!o.message.content)return"";try{return te.parse(o.message.content)}catch(d){return console.error("Markdown parse error:",d),o.message.content.replace(/\n/g,"<br>")}}),c=j(()=>{const d=o.message.role;return{"bg-blue-500 text-white":d==="user","bg-gray-100 text-gray-900":d==="assistant","bg-yellow-50 text-yellow-900 border border-yellow-200":d==="system","bg-purple-50 text-purple-900 border border-purple-200":d==="tool"}}),n=d=>({user:"You",assistant:"Agent",system:"System",tool:"Tool"})[d]||d,g=d=>d?new Date(d).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(d,v)=>(l(),i("div",{class:w(["message-wrapper flex",s.message.role==="user"?"justify-end":"justify-start"])},[e("div",{class:w(["message max-w-2xl rounded-2xl px-4 py-3 shadow-sm",c.value])},[e("div",Pe,y(n(s.message.role)),1),e("div",{class:"prose prose-sm max-w-none",innerHTML:u.value},null,8,Ue),s.message.streaming?(l(),i("div",Je,[...v[0]||(v[0]=[e("span",null,null,-1),e("span",null,null,-1),e("span",null,null,-1)])])):x("",!0),s.message.timestamp?(l(),i("div",We,y(g(s.message.timestamp)),1)):x("",!0)],2)],2))}},qe=U(Re,[["__scopeId","data-v-844874b6"]]),Ke={class:"chat-input border-t bg-white p-4"},Ye={class:"max-w-3xl mx-auto"},Ge={class:"flex items-end space-x-3"},Qe=["disabled"],Xe=["disabled"],Ze={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},et={key:1,class:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},tt={key:0,class:"text-xs text-gray-500 mt-2 text-right"},st={__name:"ChatInput",props:{disabled:{type:Boolean,default:!1}},emits:["send"],setup(s,{emit:o}){const u=s,c=o,n=h(""),g=h(null),d=()=>{n.value.trim()&&!u.disabled&&(c("send",n.value.trim()),n.value="",K(()=>m()))},v=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),d())},m=()=>{const a=g.value;a&&(a.style.height="auto",a.style.height=Math.min(a.scrollHeight,200)+"px")};return(a,r)=>(l(),i("div",Ke,[e("div",Ye,[e("div",Ge,[Y(e("textarea",{ref_key:"textareaRef",ref:g,"onUpdate:modelValue":r[0]||(r[0]=p=>n.value=p),disabled:s.disabled,placeholder:"Send a message... (Shift+Enter for new line)",rows:"1",class:"flex-1 resize-none border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",onKeydown:v,onInput:m},null,40,Qe),[[se,n.value]]),e("button",{disabled:s.disabled||!n.value.trim(),onClick:d,class:w(["px-6 py-3 rounded-xl font-medium transition-colors flex items-center justify-center",s.disabled||!n.value.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"])},[s.disabled?(l(),i("svg",et,[...r[2]||(r[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(l(),i("svg",Ze,[...r[1]||(r[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])]))],10,Xe)]),n.value.length>0?(l(),i("div",tt,y(n.value.length)+" characters ",1)):x("",!0)])]))}},ot={class:"chat-interface flex flex-col h-full bg-white"},nt={class:"max-w-3xl mx-auto space-y-4"},rt={key:0,class:"h-full flex items-center justify-center min-h-96"},at={key:1,class:"flex items-center space-x-2 text-gray-500"},lt={__name:"ChatInterface",props:{messages:{type:Array,default:()=>[]},isStreaming:{type:Boolean,default:!1}},emits:["send"],setup(s,{emit:o}){const u=s,c=o,n=h(null),g=j(()=>{if(u.messages.length===0)return!1;const m=u.messages[u.messages.length-1];return m&&m.content&&m.content.length>0});Z(()=>u.messages.length,()=>{K(()=>{d()})}),Z(()=>{var m;return(m=u.messages[u.messages.length-1])==null?void 0:m.content},()=>{K(()=>{d()})},{deep:!0});function d(){n.value&&n.value.scrollTo({top:n.value.scrollHeight,behavior:"smooth"})}function v(m){c("send",m)}return(m,a)=>(l(),i("div",ot,[e("div",{ref_key:"messagesContainer",ref:n,class:"messages-container flex-1 overflow-y-auto px-4 py-6"},[e("div",nt,[s.messages.length===0&&!s.isStreaming?(l(),i("div",rt,[...a[0]||(a[0]=[e("div",{class:"text-center"},[e("div",{class:"text-5xl mb-4"},"ðŸ¤–"),e("h2",{class:"text-xl font-semibold text-gray-900 mb-2"},"Start a conversation"),e("p",{class:"text-gray-500"}," Send a message to begin interacting with the agent. ")],-1)])])):x("",!0),(l(!0),i(N,null,B(s.messages,(r,p)=>(l(),P(qe,{key:p,message:r},null,8,["message"]))),128)),s.isStreaming&&!g.value?(l(),i("div",at,[...a[1]||(a[1]=[be('<div class="typing-indicator flex space-x-1" data-v-e4e12f37><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:0ms;" data-v-e4e12f37></span><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:150ms;" data-v-e4e12f37></span><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:300ms;" data-v-e4e12f37></span></div><span class="text-sm" data-v-e4e12f37>Agent is thinking...</span>',2)])])):x("",!0)])],512),b(st,{disabled:s.isStreaming,onSend:v},null,8,["disabled"])]))}},it=U(lt,[["__scopeId","data-v-e4e12f37"]]),ct={class:"agent-status flex items-center space-x-2 text-sm"},ut={class:"text-gray-600"},dt={__name:"AgentStatusIndicator",props:{status:{type:String,default:"idle"}},setup(s){const o=s,u=j(()=>["running","streaming","thinking"].includes(o.status)),c=j(()=>({idle:"bg-gray-400",running:"bg-blue-500",streaming:"bg-green-500",thinking:"bg-purple-500",error:"bg-red-500",completed:"bg-green-500"})[o.status]||"bg-gray-400"),n=j(()=>({idle:"Waiting for input",running:"Processing...",streaming:"Generating response...",thinking:"Thinking...",error:"Error occurred",completed:"Ready"})[o.status]||"Unknown status");return(g,d)=>(l(),i("div",ct,[e("div",{class:w(["w-2 h-2 rounded-full",c.value,{"animate-pulse":u.value}])},null,2),e("span",ut,y(n.value),1)]))}},gt={class:"flex items-start justify-between"},mt={class:"flex items-start space-x-2 flex-1"},pt={key:0,class:"animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ft={key:1,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},vt={key:2,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ht={key:3,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},yt={class:"flex-1 min-w-0"},xt={class:"font-medium text-sm truncate"},bt={class:"text-xs text-gray-500 mt-0.5"},_t={key:0,class:"mt-3 pt-3 border-t space-y-2"},kt={key:0},wt={class:"text-xs bg-gray-50 p-2 rounded overflow-x-auto border border-gray-200 max-h-40"},$t={key:1},Ct={class:"text-xs bg-gray-50 p-2 rounded overflow-x-auto border border-gray-200 max-h-40"},St={key:2,class:"bg-red-50 p-2 rounded border border-red-200"},Mt={class:"text-xs text-red-700 whitespace-pre-wrap"},At={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(s){const o=s,u=h(!1),c=()=>{u.value=!u.value},n={"border-blue-200 bg-blue-50":o.toolCall.status==="running","border-green-200 bg-green-50":o.toolCall.status==="success","border-red-200 bg-red-50":o.toolCall.status==="error","border-gray-200 bg-white":o.toolCall.status==="pending"},g={"text-blue-500":o.toolCall.status==="running","text-green-500":o.toolCall.status==="success","text-red-500":o.toolCall.status==="error","text-gray-400":o.toolCall.status==="pending"},d=a=>a?new Date(a).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",v=a=>{if(typeof a=="string")try{return JSON.stringify(JSON.parse(a),null,2)}catch(r){return a}else if(typeof a=="object")return JSON.stringify(a,null,2);return String(a)},m=a=>{const r=v(a);return r.length>500?r.substring(0,500)+`
... (truncated)`:r};return(a,r)=>(l(),i("div",{class:w(["tool-call-card border rounded-lg p-3 cursor-pointer transition-all",n]),onClick:c},[e("div",gt,[e("div",mt,[e("div",{class:w(["w-5 h-5 mt-0.5 flex-shrink-0",g])},[s.toolCall.status==="running"?(l(),i("svg",pt,[...r[0]||(r[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):s.toolCall.status==="success"?(l(),i("svg",ft,[...r[1]||(r[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):s.toolCall.status==="error"?(l(),i("svg",vt,[...r[2]||(r[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):(l(),i("svg",ht,[...r[3]||(r[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])]))],2),e("div",yt,[e("div",xt,y(s.toolCall.tool_name),1),e("div",bt,y(d(s.toolCall.timestamp)),1)])]),(l(),i("svg",{class:w(["w-4 h-4 text-gray-400 transform transition-transform flex-shrink-0 ml-2",{"rotate-180":u.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...r[4]||(r[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),u.value?(l(),i("div",_t,[s.toolCall.input?(l(),i("div",kt,[r[5]||(r[5]=e("div",{class:"text-xs font-medium text-gray-600 mb-1"},"Input",-1)),e("pre",wt,y(v(s.toolCall.input)),1)])):x("",!0),s.toolCall.output?(l(),i("div",$t,[r[6]||(r[6]=e("div",{class:"text-xs font-medium text-gray-600 mb-1"},"Output",-1)),e("pre",Ct,y(m(s.toolCall.output)),1)])):x("",!0),s.toolCall.error?(l(),i("div",St,[r[7]||(r[7]=e("div",{class:"text-xs font-medium text-red-600 mb-1"},"Error",-1)),e("pre",Mt,y(s.toolCall.error),1)])):x("",!0)])):x("",!0)],2))}},jt={class:"agent-file-list"},Tt={key:0,class:"text-center text-gray-500 text-sm py-8"},Lt={key:1,class:"space-y-2"},It=["onClick"],Nt={class:"text-xl mr-3"},Bt={class:"flex-1 min-w-0"},Ft={class:"font-medium text-sm truncate text-gray-900"},Dt={class:"text-xs text-gray-500 truncate"},Ht={__name:"AgentFileList",props:{files:{type:Array,default:()=>[]}},emits:["preview"],setup(s){const o=c=>{if(!c)return"Unknown";const n=c.split("/");return n[n.length-1]},u=c=>{const n=c||"",g=n.includes(".")?n.split(".").pop().toLowerCase():"";return{py:"ðŸ",python:"ðŸ",js:"ðŸ“œ",javascript:"ðŸ“œ",ts:"ðŸ“˜",typescript:"ðŸ“˜",vue:"ðŸ’š",json:"ðŸ“‹",md:"ðŸ“",markdown:"ðŸ“",txt:"ðŸ“„",text:"ðŸ“„",png:"ðŸ–¼ï¸",jpg:"ðŸ–¼ï¸",jpeg:"ðŸ–¼ï¸",gif:"ðŸ–¼ï¸",svg:"ðŸŽ¨",pdf:"ðŸ“•",html:"ðŸŒ",css:"ðŸŽ¨",yaml:"âš™ï¸",yml:"âš™ï¸",xml:"ðŸ“°",csv:"ðŸ“Š",sql:"ðŸ—„ï¸",sh:"ðŸ’»",bash:"ðŸ’»",dockerfile:"ðŸ³",docker:"ðŸ³"}[g]||"ðŸ“„"};return(c,n)=>(l(),i("div",jt,[s.files.length?(l(),i("div",Lt,[(l(!0),i(N,null,B(s.files,g=>(l(),i("div",{key:g.name,class:"file-item flex items-center p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors border border-gray-200",onClick:d=>c.$emit("preview",g)},[e("div",Nt,y(u(g.file_path||g.name)),1),e("div",Bt,[e("div",Ft,y(o(g.file_path||g.name)),1),e("div",Dt,y(g.file_path||g.name),1)])],8,It))),128))])):(l(),i("div",Tt,[...n[0]||(n[0]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1),A(" No files created yet ",-1)])]))]))}},Ot={class:"activity-sidebar flex flex-col h-full bg-white border-l border-gray-200"},zt={class:"p-4 border-b border-gray-200"},Vt={class:"border-b border-gray-200"},Et={class:"flex space-x-1 px-4"},Pt=["onClick"],Ut={class:"flex-1 overflow-y-auto p-4"},Jt={key:0},Wt={key:0,class:"text-center text-gray-500 text-sm py-8"},Rt={key:1,class:"space-y-3"},qt={key:1},Kt={key:0,class:"text-center text-gray-500 text-sm py-8"},Yt={key:2},Gt={key:0,class:"text-center text-gray-500 text-sm py-8"},Qt={key:1,class:"space-y-2"},Xt={class:"flex items-start space-x-3"},Zt={key:0,class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},es={key:1,class:"w-2 h-2 bg-white rounded-full animate-pulse"},ts={class:"flex-1 min-w-0"},ss={class:"text-xs text-gray-500 mt-1"},os={__name:"ActivitySidebar",props:{toolCalls:{type:Array,default:()=>[]},files:{type:Array,default:()=>[]},todos:{type:Array,default:()=>[]},agentStatus:{type:String,default:"idle"}},emits:["preview-file"],setup(s,{emit:o}){const u=s,c=o,n=h("tools"),g=j(()=>[{key:"tools",label:"Tools",count:u.toolCalls.length},{key:"files",label:"Files",count:u.files.length},{key:"todos",label:"Todos",count:u.todos.filter(a=>a.status!=="completed").length}]),d=a=>{c("preview-file",a)},v=a=>({pending:"Pending",in_progress:"In Progress",completed:"Completed"})[a]||a,m=a=>({pending:"gray",in_progress:"blue",completed:"green"})[a]||"gray";return(a,r)=>(l(),i("div",Ot,[e("div",zt,[r[0]||(r[0]=e("h3",{class:"font-semibold text-base text-gray-900"},"Agent Activity",-1)),b(dt,{status:s.agentStatus,class:"mt-2"},null,8,["status"])]),e("div",Vt,[e("div",Et,[(l(!0),i(N,null,B(g.value,p=>(l(),i("button",{key:p.key,class:w(["py-2.5 px-3 border-b-2 font-medium text-sm transition-colors",n.value===p.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"]),onClick:$=>n.value=p.key},[A(y(p.label)+" ",1),p.count>0?(l(),P(S(W),{key:0,label:String(p.count),theme:n.value===p.key?"blue":"gray",size:"sm",class:"ml-1.5"},null,8,["label","theme"])):x("",!0)],10,Pt))),128))])]),e("div",Ut,[n.value==="tools"?(l(),i("div",Jt,[s.toolCalls.length===0?(l(),i("div",Wt,[...r[1]||(r[1]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1),A(" No tool calls yet ",-1)])])):(l(),i("div",Rt,[(l(!0),i(N,null,B(s.toolCalls,(p,$)=>(l(),P(At,{key:p.id||$,"tool-call":p},null,8,["tool-call"]))),128))]))])):x("",!0),n.value==="files"?(l(),i("div",qt,[s.files.length===0?(l(),i("div",Kt,[...r[2]||(r[2]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1),A(" No files created yet ",-1)])])):(l(),P(Ht,{key:1,files:s.files,onPreview:d},null,8,["files"]))])):x("",!0),n.value==="todos"?(l(),i("div",Yt,[s.todos.length===0?(l(),i("div",Gt,[...r[3]||(r[3]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})],-1),A(" No todos yet ",-1)])])):(l(),i("div",Qt,[(l(!0),i(N,null,B(s.todos,p=>(l(),i("div",{key:p.name,class:"todo-item p-3 rounded-lg border border-gray-200 bg-white hover:bg-gray-50 transition-colors"},[e("div",Xt,[e("div",{class:w(["w-5 h-5 rounded flex items-center justify-center flex-shrink-0 mt-0.5",p.status==="completed"?"bg-green-500":p.status==="in_progress"?"bg-blue-500":"border-2 border-gray-300"])},[p.status==="completed"?(l(),i("svg",Zt,[...r[4]||(r[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"},null,-1)])])):p.status==="in_progress"?(l(),i("div",es)):x("",!0)],2),e("div",ts,[e("div",{class:w(["text-sm",p.status==="completed"?"line-through text-gray-500":"text-gray-900"])},y(p.description||p.content),3),e("div",ss,[b(S(W),{label:v(p.status),theme:m(p.status),size:"sm"},null,8,["label","theme"])])])])]))),128))]))])):x("",!0)])]))}},ns=U(os,[["__scopeId","data-v-ce009bf6"]]);class rs{constructor(){this.socket=null,this.connected=!1,this.eventHandlers=new Map}connect(){var c;if(this.socket&&this.connected)return this.socket;const o=((c=window.frappe)==null?void 0:c.socketio_port)||9e3,u=window.location.hostname;return this.socket=Ae(`${window.location.protocol}//${u}:${o}`,{withCredentials:!0,reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:10,timeout:2e4}),this.socket.on("connect",()=>{this.connected=!0,console.log("Socket.IO connected")}),this.socket.on("disconnect",n=>{this.connected=!1,console.log("Socket.IO disconnected:",n)}),this.socket.on("connect_error",n=>{console.error("Socket.IO connection error:",n)}),this.socket.on("reconnect",n=>{console.log("Socket.IO reconnected after",n,"attempts")}),this.socket}subscribe(o){this.socket||this.connect(),this.socket.emit("subscribe",o),console.log("Subscribed to channel:",o)}unsubscribe(o){this.socket&&(this.socket.emit("unsubscribe",o),console.log("Unsubscribed from channel:",o),this.eventHandlers.delete(o))}on(o,u){this.socket||this.connect(),this.socket.on(o,u)}off(o,u){this.socket&&(u?this.socket.off(o,u):this.socket.off(o))}removeAllListeners(o){this.socket&&this.socket.removeAllListeners(o)}emit(o,u){this.socket||this.connect(),this.socket.emit(o,u)}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.connected=!1,this.eventHandlers.clear())}isConnected(){var o;return this.connected&&((o=this.socket)==null?void 0:o.connected)}}const k=new rs,as={class:"agent-workspace h-screen flex flex-col overflow-hidden bg-gray-50"},ls={class:"h-12 bg-white border-b border-gray-200 flex items-center px-4 flex-shrink-0"},is={class:"flex items-center space-x-4"},cs=["title"],us={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ds={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},gs={class:"flex-1 flex justify-center"},ms={key:0,class:"flex items-center space-x-2 text-sm"},ps={class:"text-gray-600"},fs={class:"flex items-center space-x-2"},vs={class:"flex flex-1 overflow-hidden"},hs={class:"flex-1 flex flex-col min-w-0 bg-white"},ys={key:0,class:"file-viewer"},xs={class:"bg-gray-50 p-4 rounded-lg overflow-x-auto max-h-96 text-sm"},bs={class:"space-y-4"},_s=["value"],ks={key:0,class:"text-sm text-gray-600 mt-2"},ws={__name:"AgentWorkspace",props:{sessionId:String},setup(s){const o=s,u=ke(),c=h(null),n=h([]),g=h([]),d=h([]),v=h([]),m=h([]),a=h([]),r=h(!1),p=h("idle"),$=h(!1),F=h(null),I=h(""),G=h(!1),O=h(!1),z=h(!1),T=h(""),V=h(!1),Q=j(()=>T.value?g.value.find(f=>f.name===T.value):null),ae=f=>({active:"green",Active:"green",completed:"blue",error:"red",timeout:"orange"})[f]||"gray",le=()=>{window.location.href="/app"};oe(async()=>{await Promise.all([X(),ie()]),o.sessionId&&(await R(o.sessionId),q())}),ne(()=>{if(c.value){const f=`agent_session_${c.value.name}`;k.unsubscribe(f)}});async function X(){try{const f=await H.listSessions();n.value=f||[],n.value.sort((t,L)=>new Date(L.creation)-new Date(t.creation))}catch(f){console.error("Failed to load sessions:",f),n.value=[]}}async function ie(){try{g.value=await H.listAgents()}catch(f){console.error("Failed to load agents:",f),g.value=[]}}async function R(f){G.value=!0;try{const t=await H.getSession(f);c.value=t,d.value=t.messages||[],v.value=t.todos||[],m.value=t.files||[],a.value=t.tool_calls||[],p.value=t.status==="active"?"idle":t.status}catch(t){console.error("Failed to load session:",t),p.value="error"}finally{G.value=!1}}function q(){if(!c.value)return;const f=`agent_session_${c.value.name}`;k.subscribe(f),k.on("agent_token",t=>{t.session===c.value.name&&(p.value="streaming",ue(t.token))}),k.on("tool_call_start",t=>{t.session===c.value.name&&(p.value="running",a.value.push({id:Date.now().toString(),tool_name:t.tool_name,input:t.input,status:"running",timestamp:new Date}))}),k.on("tool_call_complete",t=>{if(t.session===c.value.name){const L=a.value.find(_=>_.tool_name===t.tool_name&&_.status==="running");L&&(L.status=t.success?"success":"error",L.output=t.output)}}),k.on("agent_status",t=>{t.session===c.value.name&&(p.value=t.status)}),k.on("todo_update",t=>{t.session===c.value.name&&(v.value=t.todos)}),k.on("file_update",t=>{t.session===c.value.name&&(m.value=t.files)}),k.on("agent_complete",t=>{t.session===c.value.name&&(r.value=!1,p.value="completed",de())}),k.on("agent_error",t=>{t.session===c.value.name&&(r.value=!1,p.value="error",console.error("Agent error:",t.error),d.value.push({role:"system",content:`Error: ${t.error}`}))})}async function ce(f){if(!(!f.trim()||r.value||!c.value)){d.value.push({role:"user",content:f,timestamp:new Date}),d.value.push({role:"assistant",content:"",streaming:!0}),r.value=!0,p.value="thinking";try{await H.sendMessage(c.value.name,f)}catch(t){r.value=!1,p.value="error",console.error("Failed to send message:",t),d.value.push({role:"system",content:`Error: ${t.message||"Failed to send message"}`})}}}function ue(f){const t=d.value[d.value.length-1];t&&t.streaming&&(t.content+=f)}function de(){const f=d.value[d.value.length-1];f&&(f.streaming=!1,f.timestamp=new Date)}async function ge(){z.value=!0}async function me(){if(T.value){V.value=!0;try{const f=await H.createSession(T.value);if(z.value=!1,T.value="",c.value){const t=`agent_session_${c.value.name}`;k.unsubscribe(t)}u.push(`/agent/workspace/${f.name}`),await X(),await R(f.name),q()}catch(f){console.error("Failed to create session:",f)}finally{V.value=!1}}}async function pe(f){if(c.value){const t=`agent_session_${c.value.name}`;k.unsubscribe(t)}d.value=[],a.value=[],m.value=[],v.value=[],u.push(`/agent/workspace/${f}`),await R(f),q()}async function fe(f){F.value=f,$.value=!0,I.value="Loading...";try{const t=await H.getFileContent(f.name);I.value=t||"No content"}catch(t){I.value=f.content||"Failed to load file content",console.error("Failed to load file:",t)}}return(f,t)=>{var L;return l(),i("div",as,[e("header",ls,[e("div",is,[e("button",{onClick:t[0]||(t[0]=_=>O.value=!O.value),class:"p-1.5 rounded hover:bg-gray-100 transition-colors text-gray-600",title:O.value?"Expand sidebar":"Collapse sidebar"},[O.value?(l(),i("svg",ds,[...t[6]||(t[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 5l7 7-7 7M5 5l7 7-7 7"},null,-1)])])):(l(),i("svg",us,[...t[5]||(t[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"},null,-1)])]))],8,cs),t[7]||(t[7]=e("div",{class:"flex items-center space-x-2"},[e("div",{class:"text-lg font-semibold text-gray-900"},"Deep Agents")],-1))]),e("div",gs,[c.value?(l(),i("div",ms,[e("span",ps,y(c.value.agent_definition),1),t[8]||(t[8]=e("span",{class:"text-gray-400"},"|",-1)),b(S(W),{label:c.value.status||"Active",theme:ae(c.value.status)},null,8,["label","theme"])])):x("",!0)]),e("div",fs,[b(S(J),{variant:"ghost",size:"sm",onClick:le},{default:M(()=>[...t[9]||(t[9]=[A(" Desk ",-1)])]),_:1})])]),e("div",vs,[b(_e,{name:"slide"},{default:M(()=>[O.value?x("",!0):(l(),P(Ee,{key:0,sessions:n.value,"current-session":c.value,onNewSession:ge,onSelectSession:pe},null,8,["sessions","current-session"]))]),_:1}),e("div",hs,[b(it,{messages:d.value,"is-streaming":r.value,onSend:ce},null,8,["messages","is-streaming"])]),b(ns,{"tool-calls":a.value,files:m.value,todos:v.value,"agent-status":p.value,onPreviewFile:fe},null,8,["tool-calls","files","todos","agent-status"])]),b(S(ee),{modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=_=>$.value=_),options:{title:((L=F.value)==null?void 0:L.file_path)||"File",size:"4xl"}},{"body-content":M(()=>[F.value?(l(),i("div",ys,[e("pre",xs,[e("code",null,y(I.value||"Loading..."),1)])])):x("",!0)]),_:1},8,["modelValue","options"]),b(S(ee),{modelValue:z.value,"onUpdate:modelValue":t[4]||(t[4]=_=>z.value=_),options:{title:"New Agent Session",size:"lg"}},{"body-content":M(()=>[e("div",bs,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Select Agent",-1)),Y(e("select",{"onUpdate:modelValue":t[2]||(t[2]=_=>T.value=_),class:"w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},[t[10]||(t[10]=e("option",{value:""},"Choose an agent...",-1)),(l(!0),i(N,null,B(g.value,_=>(l(),i("option",{key:_.name,value:_.name},y(_.agent_name),9,_s))),128))],512),[[we,T.value]]),Q.value?(l(),i("p",ks,y(Q.value.description||"No description available"),1)):x("",!0)])])]),actions:M(()=>[b(S(J),{variant:"subtle",onClick:t[3]||(t[3]=_=>z.value=!1)},{default:M(()=>[...t[12]||(t[12]=[A("Cancel",-1)])]),_:1}),b(S(J),{variant:"solid",onClick:me,disabled:!T.value||V.value,loading:V.value},{default:M(()=>[A(y(V.value?"Creating...":"Create Session"),1)]),_:1},8,["disabled","loading"])]),_:1},8,["modelValue"])])}}},E=U(ws,[["__scopeId","data-v-51e8410a"]]),$s=[{path:"/app/agent-chat",name:"Home",component:E},{path:"/app/agent-chat/:sessionId",name:"WorkspaceWithSession",component:E,props:!0},{path:"/agent",name:"AgentHome",component:E},{path:"/agent/workspace",name:"Workspace",component:E},{path:"/agent/workspace/:sessionId",name:"WorkspaceSession",component:E,props:!0},{path:"/:pathMatch(.*)*",redirect:"/app/agent-chat"}],Cs=$e({history:Ce(),routes:$s}),Ss={id:"app",class:"h-screen w-screen bg-gray-50"},Ms={__name:"App",setup(s){return oe(()=>{var o;k.connect(),(o=window.frappe)!=null&&o.csrf_token||fetch("/api/method/frappe.auth.get_logged_user").then(u=>u.json()).catch(console.error)}),ne(()=>{k.disconnect()}),(o,u)=>{const c=Se("router-view");return l(),i("div",Ss,[b(c)])}}},re=Me(Ms);re.use(Cs);window.frappe=window.frappe||{};const As=document.getElementById("agent-chat-app")?"#agent-chat-app":"#app";re.mount(As);
