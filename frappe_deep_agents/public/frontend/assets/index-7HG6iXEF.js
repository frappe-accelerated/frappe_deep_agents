var w=(s,o,d)=>new Promise((l,n)=>{var m=g=>{try{v(d.next(g))}catch(r){n(r)}},u=g=>{try{v(d.throw(g))}catch(r){n(r)}},v=g=>g.done?l(g.value):Promise.resolve(g.value).then(m,u);v((d=d.apply(s,o)).next())});import{_ as J,r as h,c as T,a as c,o as i,b as e,d as b,w as A,e as j,u as M,f as W,g as G,v as oe,h as x,t as y,F as B,i as F,n as $,j as R,H,k as he,p as ye,l as xe,m as be,q as Y,s as ee,x as _e,y as U,z as ne,A as re,T as ke,D as te,B as we,C as $e,E as Ce,G as Se,I as Me,J as Ae}from"./frappe-ui-BVn7k_ns.js";import{m as se}from"./markdown-C-LKGqk6.js";import{l as je}from"./socket-LzvdsN3v.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const m of n)if(m.type==="childList")for(const u of m.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function d(n){const m={};return n.integrity&&(m.integrity=n.integrity),n.referrerPolicy&&(m.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?m.credentials="include":n.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(n){if(n.ep)return;n.ep=!0;const m=d(n);fetch(n.href,m)}})();function S(d){return w(this,arguments,function*(s,o={}){var m;const l=yield fetch("/api/method/"+s,{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":((m=window.frappe)==null?void 0:m.csrf_token)||""},body:JSON.stringify(o)});if(!l.ok){const u=yield l.json().catch(()=>({}));throw new Error(u.exception||u.message||`API call failed: ${l.status}`)}return(yield l.json()).message})}const O={createSession:s=>S("frappe_deep_agents.api.create_session",{agent_definition:s}),getSession:s=>S("frappe_deep_agents.api.get_session",{session_id:s}),sendMessage:(s,o)=>S("frappe_deep_agents.api.send_message",{session_id:s,message:o}),endSession:s=>S("frappe_deep_agents.api.end_session",{session_id:s}),listAgents:()=>S("frappe_deep_agents.api.list_agents"),listSessions:(s=null,o=null)=>S("frappe_deep_agents.api.list_sessions",{agent_definition:s,status:o}),updateTodo:(s,o)=>S("frappe_deep_agents.api.update_todo",{todo_name:s,status:o}),getFileContent:s=>S("frappe_deep_agents.api.get_file_content",{file_name:s}),exportAgentYaml:s=>S("frappe_deep_agents.api.export_agent_yaml",{agent_definition:s}),importAgentYaml:s=>S("frappe_deep_agents.api.import_agent_yaml",{yaml_content:s})},Te={class:"session-sidebar flex flex-col h-full bg-gray-50 border-r border-gray-200"},Le={class:"p-3 border-b border-gray-200"},Ie={class:"p-3 border-b border-gray-200"},Ne={class:"relative"},Be={class:"flex-1 overflow-y-auto"},Fe={key:0,class:"p-4 text-center text-gray-500 text-sm"},De=["onClick"],He={class:"flex items-start justify-between"},Oe={class:"flex-1 min-w-0"},ze={class:"font-medium text-sm truncate text-gray-900"},Ve={class:"text-xs text-gray-500 mt-1 flex items-center space-x-2"},Ee={__name:"SessionSidebar",props:{sessions:{type:Array,default:()=>[]},currentSession:{type:Object,default:null}},emits:["new-session","select-session"],setup(s){const o=s,d=h(""),l=T(()=>{if(!d.value)return o.sessions;const g=d.value.toLowerCase();return o.sessions.filter(r=>{const a=(r.agent_definition||"").toLowerCase(),p=(r.name||"").toLowerCase();return a.includes(g)||p.includes(g)})}),n=g=>o.currentSession&&o.currentSession.name===g.name,m=g=>{if(!g)return"";const r=new Date(g),p=new Date-r,C=Math.floor(p/6e4),D=Math.floor(p/36e5),N=Math.floor(p/864e5);return C<1?"Just now":C<60?`${C}m ago`:D<24?`${D}h ago`:N<7?`${N}d ago`:r.toLocaleDateString("en-US",{month:"short",day:"numeric"})},u=g=>({active:"Active",completed:"Done",error:"Error",timeout:"Timeout"})[g==null?void 0:g.toLowerCase()]||g||"Active",v=g=>({active:"green",completed:"blue",error:"red",timeout:"orange"})[g==null?void 0:g.toLowerCase()]||"gray";return(g,r)=>(i(),c("div",Te,[e("div",Le,[b(M(W),{variant:"solid",onClick:r[0]||(r[0]=a=>g.$emit("new-session")),class:"w-full"},{prefix:A(()=>[...r[2]||(r[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])]),default:A(()=>[r[3]||(r[3]=j(" New Chat ",-1))]),_:1})]),e("div",Ie,[e("div",Ne,[r[4]||(r[4]=e("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),G(e("input",{"onUpdate:modelValue":r[1]||(r[1]=a=>d.value=a),placeholder:"Search sessions...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white"},null,512),[[oe,d.value]])])]),e("div",Be,[l.value.length===0?(i(),c("div",Fe,y(d.value?"No sessions found":"No sessions yet"),1)):x("",!0),(i(!0),c(B,null,F(l.value,a=>(i(),c("div",{key:a.name,class:$(["session-item p-3 cursor-pointer hover:bg-gray-100 transition-colors border-b border-gray-100",n(a)?"bg-blue-50 border-l-4 border-l-blue-500":"border-l-4 border-l-transparent"]),onClick:p=>g.$emit("select-session",a.name)},[e("div",He,[e("div",Oe,[e("div",ze,y(a.agent_definition||"Agent Session"),1),e("div",Ve,[e("span",null,y(m(a.creation)),1)])]),b(M(R),{label:u(a.status),theme:v(a.status),size:"sm"},null,8,["label","theme"])])],10,De))),128))])]))}},Pe=J(Ee,[["__scopeId","data-v-ed06ff8e"]]),Ue={class:"message-role text-xs font-semibold mb-1 opacity-75"},Je=["innerHTML"],We={key:0,class:"typing-indicator mt-2"},Re={key:1,class:"text-xs opacity-50 mt-2"},qe={__name:"ChatMessage",props:{message:{type:Object,required:!0}},setup(s){H.registerLanguage("javascript",he),H.registerLanguage("python",ye),H.registerLanguage("bash",xe),H.registerLanguage("json",be);const o=s;se.setOptions({breaks:!0,gfm:!0,highlight:function(u,v){if(v&&H.getLanguage(v))try{return H.highlight(u,{language:v}).value}catch(g){console.error("Highlight error:",g)}return u}});const d=T(()=>{if(!o.message.content)return"";try{return se.parse(o.message.content)}catch(u){return console.error("Markdown parse error:",u),o.message.content.replace(/\n/g,"<br>")}}),l=T(()=>{const u=o.message.role;return{"bg-blue-500 text-white":u==="user","bg-gray-100 text-gray-900":u==="assistant","bg-yellow-50 text-yellow-900 border border-yellow-200":u==="system","bg-purple-50 text-purple-900 border border-purple-200":u==="tool"}}),n=u=>({user:"You",assistant:"Agent",system:"System",tool:"Tool"})[u]||u,m=u=>u?new Date(u).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(u,v)=>(i(),c("div",{class:$(["message-wrapper flex",s.message.role==="user"?"justify-end":"justify-start"])},[e("div",{class:$(["message max-w-2xl rounded-2xl px-4 py-3 shadow-sm",l.value])},[e("div",Ue,y(n(s.message.role)),1),e("div",{class:"prose prose-sm max-w-none",innerHTML:d.value},null,8,Je),s.message.streaming?(i(),c("div",We,[...v[0]||(v[0]=[e("span",null,null,-1),e("span",null,null,-1),e("span",null,null,-1)])])):x("",!0),s.message.timestamp?(i(),c("div",Re,y(m(s.message.timestamp)),1)):x("",!0)],2)],2))}},Ke=J(qe,[["__scopeId","data-v-844874b6"]]),Ye={class:"chat-input border-t bg-white p-4"},Ge={class:"max-w-3xl mx-auto"},Qe={class:"flex items-end space-x-3"},Xe=["disabled"],Ze=["disabled"],et={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},tt={key:1,class:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},st={key:0,class:"text-xs text-gray-500 mt-2 text-right"},ot={__name:"ChatInput",props:{disabled:{type:Boolean,default:!1}},emits:["send"],setup(s,{emit:o}){const d=s,l=o,n=h(""),m=h(null),u=()=>{n.value.trim()&&!d.disabled&&(l("send",n.value.trim()),n.value="",Y(()=>g()))},v=r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),u())},g=()=>{const r=m.value;r&&(r.style.height="auto",r.style.height=Math.min(r.scrollHeight,200)+"px")};return(r,a)=>(i(),c("div",Ye,[e("div",Ge,[e("div",Qe,[G(e("textarea",{ref_key:"textareaRef",ref:m,"onUpdate:modelValue":a[0]||(a[0]=p=>n.value=p),disabled:s.disabled,placeholder:"Send a message... (Shift+Enter for new line)",rows:"1",class:"flex-1 resize-none border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",onKeydown:v,onInput:g},null,40,Xe),[[oe,n.value]]),e("button",{disabled:s.disabled||!n.value.trim(),onClick:u,class:$(["px-6 py-3 rounded-xl font-medium transition-colors flex items-center justify-center",s.disabled||!n.value.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"])},[s.disabled?(i(),c("svg",tt,[...a[2]||(a[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(i(),c("svg",et,[...a[1]||(a[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])]))],10,Ze)]),n.value.length>0?(i(),c("div",st,y(n.value.length)+" characters ",1)):x("",!0)])]))}},nt={class:"chat-interface flex flex-col h-full bg-white"},rt={class:"max-w-3xl mx-auto space-y-4"},at={key:0,class:"h-full flex items-center justify-center min-h-96"},lt={key:1,class:"flex items-center space-x-2 text-gray-500"},it={__name:"ChatInterface",props:{messages:{type:Array,default:()=>[]},isStreaming:{type:Boolean,default:!1}},emits:["send"],setup(s,{emit:o}){const d=s,l=o,n=h(null),m=T(()=>{if(d.messages.length===0)return!1;const g=d.messages[d.messages.length-1];return g&&g.content&&g.content.length>0});ee(()=>d.messages.length,()=>{Y(()=>{u()})}),ee(()=>{var g;return(g=d.messages[d.messages.length-1])==null?void 0:g.content},()=>{Y(()=>{u()})},{deep:!0});function u(){n.value&&n.value.scrollTo({top:n.value.scrollHeight,behavior:"smooth"})}function v(g){l("send",g)}return(g,r)=>(i(),c("div",nt,[e("div",{ref_key:"messagesContainer",ref:n,class:"messages-container flex-1 overflow-y-auto px-4 py-6"},[e("div",rt,[s.messages.length===0&&!s.isStreaming?(i(),c("div",at,[...r[0]||(r[0]=[e("div",{class:"text-center"},[e("div",{class:"text-5xl mb-4"},"ðŸ¤–"),e("h2",{class:"text-xl font-semibold text-gray-900 mb-2"},"Start a conversation"),e("p",{class:"text-gray-500"}," Send a message to begin interacting with the agent. ")],-1)])])):x("",!0),(i(!0),c(B,null,F(s.messages,(a,p)=>(i(),U(Ke,{key:p,message:a},null,8,["message"]))),128)),s.isStreaming&&!m.value?(i(),c("div",lt,[...r[1]||(r[1]=[_e('<div class="typing-indicator flex space-x-1" data-v-e4e12f37><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:0ms;" data-v-e4e12f37></span><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:150ms;" data-v-e4e12f37></span><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:300ms;" data-v-e4e12f37></span></div><span class="text-sm" data-v-e4e12f37>Agent is thinking...</span>',2)])])):x("",!0)])],512),b(ot,{disabled:s.isStreaming,onSend:v},null,8,["disabled"])]))}},ct=J(it,[["__scopeId","data-v-e4e12f37"]]),ut={class:"agent-status flex items-center space-x-2 text-sm"},dt={class:"text-gray-600"},gt={__name:"AgentStatusIndicator",props:{status:{type:String,default:"idle"}},setup(s){const o=s,d=T(()=>["running","streaming","thinking"].includes(o.status)),l=T(()=>({idle:"bg-gray-400",running:"bg-blue-500",streaming:"bg-green-500",thinking:"bg-purple-500",error:"bg-red-500",completed:"bg-green-500"})[o.status]||"bg-gray-400"),n=T(()=>({idle:"Waiting for input",running:"Processing...",streaming:"Generating response...",thinking:"Thinking...",error:"Error occurred",completed:"Ready"})[o.status]||"Unknown status");return(m,u)=>(i(),c("div",ut,[e("div",{class:$(["w-2 h-2 rounded-full",l.value,{"animate-pulse":d.value}])},null,2),e("span",dt,y(n.value),1)]))}},mt={class:"flex items-start justify-between"},pt={class:"flex items-start space-x-2 flex-1"},ft={key:0,class:"animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},vt={key:1,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ht={key:2,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},yt={key:3,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},xt={class:"flex-1 min-w-0"},bt={class:"font-medium text-sm truncate"},_t={class:"text-xs text-gray-500 mt-0.5"},kt={key:0,class:"mt-3 pt-3 border-t space-y-2"},wt={key:0},$t={class:"text-xs bg-gray-50 p-2 rounded overflow-x-auto border border-gray-200 max-h-40"},Ct={key:1},St={class:"text-xs bg-gray-50 p-2 rounded overflow-x-auto border border-gray-200 max-h-40"},Mt={key:2,class:"bg-red-50 p-2 rounded border border-red-200"},At={class:"text-xs text-red-700 whitespace-pre-wrap"},jt={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(s){const o=s,d=h(!1),l=()=>{d.value=!d.value},n={"border-blue-200 bg-blue-50":o.toolCall.status==="running","border-green-200 bg-green-50":o.toolCall.status==="success","border-red-200 bg-red-50":o.toolCall.status==="error","border-gray-200 bg-white":o.toolCall.status==="pending"},m={"text-blue-500":o.toolCall.status==="running","text-green-500":o.toolCall.status==="success","text-red-500":o.toolCall.status==="error","text-gray-400":o.toolCall.status==="pending"},u=r=>r?new Date(r).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",v=r=>{if(typeof r=="string")try{return JSON.stringify(JSON.parse(r),null,2)}catch(a){return r}else if(typeof r=="object")return JSON.stringify(r,null,2);return String(r)},g=r=>{const a=v(r);return a.length>500?a.substring(0,500)+`
... (truncated)`:a};return(r,a)=>(i(),c("div",{class:$(["tool-call-card border rounded-lg p-3 cursor-pointer transition-all",n]),onClick:l},[e("div",mt,[e("div",pt,[e("div",{class:$(["w-5 h-5 mt-0.5 flex-shrink-0",m])},[s.toolCall.status==="running"?(i(),c("svg",ft,[...a[0]||(a[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):s.toolCall.status==="success"?(i(),c("svg",vt,[...a[1]||(a[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):s.toolCall.status==="error"?(i(),c("svg",ht,[...a[2]||(a[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):(i(),c("svg",yt,[...a[3]||(a[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])]))],2),e("div",xt,[e("div",bt,y(s.toolCall.tool_name),1),e("div",_t,y(u(s.toolCall.timestamp)),1)])]),(i(),c("svg",{class:$(["w-4 h-4 text-gray-400 transform transition-transform flex-shrink-0 ml-2",{"rotate-180":d.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...a[4]||(a[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),d.value?(i(),c("div",kt,[s.toolCall.input?(i(),c("div",wt,[a[5]||(a[5]=e("div",{class:"text-xs font-medium text-gray-600 mb-1"},"Input",-1)),e("pre",$t,y(v(s.toolCall.input)),1)])):x("",!0),s.toolCall.output?(i(),c("div",Ct,[a[6]||(a[6]=e("div",{class:"text-xs font-medium text-gray-600 mb-1"},"Output",-1)),e("pre",St,y(g(s.toolCall.output)),1)])):x("",!0),s.toolCall.error?(i(),c("div",Mt,[a[7]||(a[7]=e("div",{class:"text-xs font-medium text-red-600 mb-1"},"Error",-1)),e("pre",At,y(s.toolCall.error),1)])):x("",!0)])):x("",!0)],2))}},Tt={class:"agent-file-list"},Lt={key:0,class:"text-center text-gray-500 text-sm py-8"},It={key:1,class:"space-y-2"},Nt=["onClick"],Bt={class:"text-xl mr-3"},Ft={class:"flex-1 min-w-0"},Dt={class:"font-medium text-sm truncate text-gray-900"},Ht={class:"text-xs text-gray-500 truncate"},Ot={__name:"AgentFileList",props:{files:{type:Array,default:()=>[]}},emits:["preview"],setup(s){const o=l=>{if(!l)return"Unknown";const n=l.split("/");return n[n.length-1]},d=l=>{const n=l||"",m=n.includes(".")?n.split(".").pop().toLowerCase():"";return{py:"ðŸ",python:"ðŸ",js:"ðŸ“œ",javascript:"ðŸ“œ",ts:"ðŸ“˜",typescript:"ðŸ“˜",vue:"ðŸ’š",json:"ðŸ“‹",md:"ðŸ“",markdown:"ðŸ“",txt:"ðŸ“„",text:"ðŸ“„",png:"ðŸ–¼ï¸",jpg:"ðŸ–¼ï¸",jpeg:"ðŸ–¼ï¸",gif:"ðŸ–¼ï¸",svg:"ðŸŽ¨",pdf:"ðŸ“•",html:"ðŸŒ",css:"ðŸŽ¨",yaml:"âš™ï¸",yml:"âš™ï¸",xml:"ðŸ“°",csv:"ðŸ“Š",sql:"ðŸ—„ï¸",sh:"ðŸ’»",bash:"ðŸ’»",dockerfile:"ðŸ³",docker:"ðŸ³"}[m]||"ðŸ“„"};return(l,n)=>(i(),c("div",Tt,[s.files.length?(i(),c("div",It,[(i(!0),c(B,null,F(s.files,m=>(i(),c("div",{key:m.name,class:"file-item flex items-center p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors border border-gray-200",onClick:u=>l.$emit("preview",m)},[e("div",Bt,y(d(m.file_path||m.name)),1),e("div",Ft,[e("div",Dt,y(o(m.file_path||m.name)),1),e("div",Ht,y(m.file_path||m.name),1)])],8,Nt))),128))])):(i(),c("div",Lt,[...n[0]||(n[0]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1),j(" No files created yet ",-1)])]))]))}},zt={class:"activity-sidebar flex flex-col h-full bg-white border-l border-gray-200"},Vt={class:"p-4 border-b border-gray-200"},Et={class:"border-b border-gray-200"},Pt={class:"flex space-x-1 px-4"},Ut=["onClick"],Jt={class:"flex-1 overflow-y-auto p-4"},Wt={key:0},Rt={key:0,class:"text-center text-gray-500 text-sm py-8"},qt={key:1,class:"space-y-3"},Kt={key:1},Yt={key:0,class:"text-center text-gray-500 text-sm py-8"},Gt={key:2},Qt={key:0,class:"text-center text-gray-500 text-sm py-8"},Xt={key:1,class:"space-y-2"},Zt={class:"flex items-start space-x-3"},es={key:0,class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ts={key:1,class:"w-2 h-2 bg-white rounded-full animate-pulse"},ss={class:"flex-1 min-w-0"},os={class:"text-xs text-gray-500 mt-1"},ns={__name:"ActivitySidebar",props:{toolCalls:{type:Array,default:()=>[]},files:{type:Array,default:()=>[]},todos:{type:Array,default:()=>[]},agentStatus:{type:String,default:"idle"}},emits:["preview-file"],setup(s,{emit:o}){const d=s,l=o,n=h("tools"),m=T(()=>[{key:"tools",label:"Tools",count:d.toolCalls.length},{key:"files",label:"Files",count:d.files.length},{key:"todos",label:"Todos",count:d.todos.filter(r=>r.status!=="completed").length}]),u=r=>{l("preview-file",r)},v=r=>({pending:"Pending",in_progress:"In Progress",completed:"Completed"})[r]||r,g=r=>({pending:"gray",in_progress:"blue",completed:"green"})[r]||"gray";return(r,a)=>(i(),c("div",zt,[e("div",Vt,[a[0]||(a[0]=e("h3",{class:"font-semibold text-base text-gray-900"},"Agent Activity",-1)),b(gt,{status:s.agentStatus,class:"mt-2"},null,8,["status"])]),e("div",Et,[e("div",Pt,[(i(!0),c(B,null,F(m.value,p=>(i(),c("button",{key:p.key,class:$(["py-2.5 px-3 border-b-2 font-medium text-sm transition-colors",n.value===p.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"]),onClick:C=>n.value=p.key},[j(y(p.label)+" ",1),p.count>0?(i(),U(M(R),{key:0,label:String(p.count),theme:n.value===p.key?"blue":"gray",size:"sm",class:"ml-1.5"},null,8,["label","theme"])):x("",!0)],10,Ut))),128))])]),e("div",Jt,[n.value==="tools"?(i(),c("div",Wt,[s.toolCalls.length===0?(i(),c("div",Rt,[...a[1]||(a[1]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1),j(" No tool calls yet ",-1)])])):(i(),c("div",qt,[(i(!0),c(B,null,F(s.toolCalls,(p,C)=>(i(),U(jt,{key:p.id||C,"tool-call":p},null,8,["tool-call"]))),128))]))])):x("",!0),n.value==="files"?(i(),c("div",Kt,[s.files.length===0?(i(),c("div",Yt,[...a[2]||(a[2]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1),j(" No files created yet ",-1)])])):(i(),U(Ot,{key:1,files:s.files,onPreview:u},null,8,["files"]))])):x("",!0),n.value==="todos"?(i(),c("div",Gt,[s.todos.length===0?(i(),c("div",Qt,[...a[3]||(a[3]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})],-1),j(" No todos yet ",-1)])])):(i(),c("div",Xt,[(i(!0),c(B,null,F(s.todos,p=>(i(),c("div",{key:p.name,class:"todo-item p-3 rounded-lg border border-gray-200 bg-white hover:bg-gray-50 transition-colors"},[e("div",Zt,[e("div",{class:$(["w-5 h-5 rounded flex items-center justify-center flex-shrink-0 mt-0.5",p.status==="completed"?"bg-green-500":p.status==="in_progress"?"bg-blue-500":"border-2 border-gray-300"])},[p.status==="completed"?(i(),c("svg",es,[...a[4]||(a[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"},null,-1)])])):p.status==="in_progress"?(i(),c("div",ts)):x("",!0)],2),e("div",ss,[e("div",{class:$(["text-sm",p.status==="completed"?"line-through text-gray-500":"text-gray-900"])},y(p.description||p.content),3),e("div",os,[b(M(R),{label:v(p.status),theme:g(p.status),size:"sm"},null,8,["label","theme"])])])])]))),128))]))])):x("",!0)])]))}},rs=J(ns,[["__scopeId","data-v-ce009bf6"]]);class as{constructor(){this.socket=null,this.connected=!1,this.eventHandlers=new Map}connect(){var l;if(this.socket&&this.connected)return this.socket;const o=((l=window.frappe)==null?void 0:l.socketio_port)||9e3,d=window.location.hostname;return this.socket=je(`${window.location.protocol}//${d}:${o}`,{withCredentials:!0,reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:10,timeout:2e4}),this.socket.on("connect",()=>{this.connected=!0,console.log("Socket.IO connected")}),this.socket.on("disconnect",n=>{this.connected=!1,console.log("Socket.IO disconnected:",n)}),this.socket.on("connect_error",n=>{console.error("Socket.IO connection error:",n)}),this.socket.on("reconnect",n=>{console.log("Socket.IO reconnected after",n,"attempts")}),this.socket}subscribe(o){this.socket||this.connect(),this.socket.emit("subscribe",o),console.log("Subscribed to channel:",o)}unsubscribe(o){this.socket&&(this.socket.emit("unsubscribe",o),console.log("Unsubscribed from channel:",o),this.eventHandlers.delete(o))}on(o,d){this.socket||this.connect(),this.socket.on(o,d)}off(o,d){this.socket&&(d?this.socket.off(o,d):this.socket.off(o))}removeAllListeners(o){this.socket&&this.socket.removeAllListeners(o)}emit(o,d){this.socket||this.connect(),this.socket.emit(o,d)}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.connected=!1,this.eventHandlers.clear())}isConnected(){var o;return this.connected&&((o=this.socket)==null?void 0:o.connected)}}const k=new as,ls={class:"agent-workspace h-screen flex flex-col overflow-hidden bg-gray-50"},is={class:"h-12 bg-white border-b border-gray-200 flex items-center px-4 flex-shrink-0"},cs={class:"flex items-center space-x-4"},us=["title"],ds={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},gs={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ms={class:"flex-1 flex justify-center"},ps={key:0,class:"flex items-center space-x-2 text-sm"},fs={class:"text-gray-600"},vs={class:"flex items-center space-x-2"},hs={class:"flex flex-1 overflow-hidden"},ys={class:"flex-1 flex flex-col min-w-0 bg-white"},xs={key:0,class:"file-viewer"},bs={class:"bg-gray-50 p-4 rounded-lg overflow-x-auto max-h-96 text-sm"},_s={class:"space-y-4"},ks=["value"],ws={key:0,class:"text-sm text-gray-600 mt-2"},$s={__name:"AgentWorkspace",props:{sessionId:String},setup(s){const o=s,d=we(),l=h(null),n=h([]),m=h([]),u=h([]),v=h([]),g=h([]),r=h([]),a=h(!1),p=h("idle"),C=h(!1),D=h(null),N=h(""),Q=h(!1),z=h(!1),V=h(!1),L=h(""),E=h(!1),X=T(()=>L.value?m.value.find(f=>f.name===L.value):null),le=f=>({active:"green",Active:"green",completed:"blue",error:"red",timeout:"orange"})[f]||"gray",ie=()=>{window.location.href="/app"};ne(()=>w(this,null,function*(){yield Promise.all([Z(),ce()]),o.sessionId&&(yield q(o.sessionId),K())})),re(()=>{if(l.value){const f=`agent_session_${l.value.name}`;k.unsubscribe(f)}});function Z(){return w(this,null,function*(){try{const f=yield O.listSessions();n.value=f||[],n.value.sort((t,I)=>new Date(I.creation)-new Date(t.creation))}catch(f){console.error("Failed to load sessions:",f),n.value=[]}})}function ce(){return w(this,null,function*(){try{m.value=yield O.listAgents()}catch(f){console.error("Failed to load agents:",f),m.value=[]}})}function q(f){return w(this,null,function*(){Q.value=!0;try{const t=yield O.getSession(f);l.value=t,u.value=t.messages||[],v.value=t.todos||[],g.value=t.files||[],r.value=t.tool_calls||[],p.value=t.status==="active"?"idle":t.status}catch(t){console.error("Failed to load session:",t),p.value="error"}finally{Q.value=!1}})}function K(){if(!l.value)return;const f=`agent_session_${l.value.name}`;k.subscribe(f),k.on("agent_token",t=>{t.session===l.value.name&&(p.value="streaming",de(t.token))}),k.on("tool_call_start",t=>{t.session===l.value.name&&(p.value="running",r.value.push({id:Date.now().toString(),tool_name:t.tool_name,input:t.input,status:"running",timestamp:new Date}))}),k.on("tool_call_complete",t=>{if(t.session===l.value.name){const I=r.value.find(_=>_.tool_name===t.tool_name&&_.status==="running");I&&(I.status=t.success?"success":"error",I.output=t.output)}}),k.on("agent_status",t=>{t.session===l.value.name&&(p.value=t.status)}),k.on("todo_update",t=>{t.session===l.value.name&&(v.value=t.todos)}),k.on("file_update",t=>{t.session===l.value.name&&(g.value=t.files)}),k.on("agent_complete",t=>{t.session===l.value.name&&(a.value=!1,p.value="completed",ge())}),k.on("agent_error",t=>{t.session===l.value.name&&(a.value=!1,p.value="error",console.error("Agent error:",t.error),u.value.push({role:"system",content:`Error: ${t.error}`}))})}function ue(f){return w(this,null,function*(){if(!(!f.trim()||a.value||!l.value)){u.value.push({role:"user",content:f,timestamp:new Date}),u.value.push({role:"assistant",content:"",streaming:!0}),a.value=!0,p.value="thinking";try{yield O.sendMessage(l.value.name,f)}catch(t){a.value=!1,p.value="error",console.error("Failed to send message:",t),u.value.push({role:"system",content:`Error: ${t.message||"Failed to send message"}`})}}})}function de(f){const t=u.value[u.value.length-1];t&&t.streaming&&(t.content+=f)}function ge(){const f=u.value[u.value.length-1];f&&(f.streaming=!1,f.timestamp=new Date)}function me(){return w(this,null,function*(){V.value=!0})}function pe(){return w(this,null,function*(){if(L.value){E.value=!0;try{const f=yield O.createSession(L.value);if(V.value=!1,L.value="",l.value){const t=`agent_session_${l.value.name}`;k.unsubscribe(t)}d.push(`/agent/workspace/${f.name}`),yield Z(),yield q(f.name),K()}catch(f){console.error("Failed to create session:",f)}finally{E.value=!1}}})}function fe(f){return w(this,null,function*(){if(l.value){const t=`agent_session_${l.value.name}`;k.unsubscribe(t)}u.value=[],r.value=[],g.value=[],v.value=[],d.push(`/agent/workspace/${f}`),yield q(f),K()})}function ve(f){return w(this,null,function*(){D.value=f,C.value=!0,N.value="Loading...";try{const t=yield O.getFileContent(f.name);N.value=t||"No content"}catch(t){N.value=f.content||"Failed to load file content",console.error("Failed to load file:",t)}})}return(f,t)=>{var I;return i(),c("div",ls,[e("header",is,[e("div",cs,[e("button",{onClick:t[0]||(t[0]=_=>z.value=!z.value),class:"p-1.5 rounded hover:bg-gray-100 transition-colors text-gray-600",title:z.value?"Expand sidebar":"Collapse sidebar"},[z.value?(i(),c("svg",gs,[...t[6]||(t[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 5l7 7-7 7M5 5l7 7-7 7"},null,-1)])])):(i(),c("svg",ds,[...t[5]||(t[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"},null,-1)])]))],8,us),t[7]||(t[7]=e("div",{class:"flex items-center space-x-2"},[e("div",{class:"text-lg font-semibold text-gray-900"},"Deep Agents")],-1))]),e("div",ms,[l.value?(i(),c("div",ps,[e("span",fs,y(l.value.agent_definition),1),t[8]||(t[8]=e("span",{class:"text-gray-400"},"|",-1)),b(M(R),{label:l.value.status||"Active",theme:le(l.value.status)},null,8,["label","theme"])])):x("",!0)]),e("div",vs,[b(M(W),{variant:"ghost",size:"sm",onClick:ie},{default:A(()=>[...t[9]||(t[9]=[j(" Desk ",-1)])]),_:1})])]),e("div",hs,[b(ke,{name:"slide"},{default:A(()=>[z.value?x("",!0):(i(),U(Pe,{key:0,sessions:n.value,"current-session":l.value,onNewSession:me,onSelectSession:fe},null,8,["sessions","current-session"]))]),_:1}),e("div",ys,[b(ct,{messages:u.value,"is-streaming":a.value,onSend:ue},null,8,["messages","is-streaming"])]),b(rs,{"tool-calls":r.value,files:g.value,todos:v.value,"agent-status":p.value,onPreviewFile:ve},null,8,["tool-calls","files","todos","agent-status"])]),b(M(te),{modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=_=>C.value=_),options:{title:((I=D.value)==null?void 0:I.file_path)||"File",size:"4xl"}},{"body-content":A(()=>[D.value?(i(),c("div",xs,[e("pre",bs,[e("code",null,y(N.value||"Loading..."),1)])])):x("",!0)]),_:1},8,["modelValue","options"]),b(M(te),{modelValue:V.value,"onUpdate:modelValue":t[4]||(t[4]=_=>V.value=_),options:{title:"New Agent Session",size:"lg"}},{"body-content":A(()=>[e("div",_s,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Select Agent",-1)),G(e("select",{"onUpdate:modelValue":t[2]||(t[2]=_=>L.value=_),class:"w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},[t[10]||(t[10]=e("option",{value:""},"Choose an agent...",-1)),(i(!0),c(B,null,F(m.value,_=>(i(),c("option",{key:_.name,value:_.name},y(_.agent_name),9,ks))),128))],512),[[$e,L.value]]),X.value?(i(),c("p",ws,y(X.value.description||"No description available"),1)):x("",!0)])])]),actions:A(()=>[b(M(W),{variant:"subtle",onClick:t[3]||(t[3]=_=>V.value=!1)},{default:A(()=>[...t[12]||(t[12]=[j("Cancel",-1)])]),_:1}),b(M(W),{variant:"solid",onClick:pe,disabled:!L.value||E.value,loading:E.value},{default:A(()=>[j(y(E.value?"Creating...":"Create Session"),1)]),_:1},8,["disabled","loading"])]),_:1},8,["modelValue"])])}}},P=J($s,[["__scopeId","data-v-51e8410a"]]),Cs=[{path:"/app/agent-chat",name:"Home",component:P},{path:"/app/agent-chat/:sessionId",name:"WorkspaceWithSession",component:P,props:!0},{path:"/agent",name:"AgentHome",component:P},{path:"/agent/workspace",name:"Workspace",component:P},{path:"/agent/workspace/:sessionId",name:"WorkspaceSession",component:P,props:!0},{path:"/:pathMatch(.*)*",redirect:"/app/agent-chat"}],Ss=Ce({history:Se(),routes:Cs}),Ms={id:"app",class:"h-screen w-screen bg-gray-50"},As={__name:"App",setup(s){return ne(()=>{var o;k.connect(),(o=window.frappe)!=null&&o.csrf_token||fetch("/api/method/frappe.auth.get_logged_user").then(d=>d.json()).catch(console.error)}),re(()=>{k.disconnect()}),(o,d)=>{const l=Me("router-view");return i(),c("div",Ms,[b(l)])}}},ae=Ae(As);ae.use(Ss);window.frappe=window.frappe||{};const js=document.getElementById("agent-chat-app")?"#agent-chat-app":"#app";ae.mount(js);
