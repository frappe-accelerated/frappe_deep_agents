import{_ as P,r as h,c as j,a as c,o as l,b as e,d as _,w as M,e as A,u as S,f as U,g as K,v as se,h as x,t as y,F as I,i as N,n as w,j as J,H as F,k as ve,p as he,l as ye,m as xe,q,s as Z,x as be,y as E,z as oe,A as ne,T as _e,D as ee,B as ke,C as we,E as $e,G as Ce,I as Se,J as Me}from"./frappe-ui-BE2yMoQR.js";import{m as te}from"./markdown-Bx3_u7e7.js";import{l as Ae}from"./socket-qXw27f4H.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const g of a)if(g.type==="childList")for(const d of g.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function u(a){const g={};return a.integrity&&(g.integrity=a.integrity),a.referrerPolicy&&(g.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?g.credentials="include":a.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function i(a){if(a.ep)return;a.ep=!0;const g=u(a);fetch(a.href,g)}})();async function C(s,o={}){const u=await fetch("/api/method/"+s,{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.frappe?.csrf_token||""},body:JSON.stringify(o)});if(!u.ok){const a=await u.json().catch(()=>({}));throw new Error(a.exception||a.message||`API call failed: ${u.status}`)}return(await u.json()).message}const D={createSession:s=>C("frappe_deep_agents.api.create_session",{agent_definition:s}),getSession:s=>C("frappe_deep_agents.api.get_session",{session_id:s}),sendMessage:(s,o)=>C("frappe_deep_agents.api.send_message",{session_id:s,message:o}),endSession:s=>C("frappe_deep_agents.api.end_session",{session_id:s}),listAgents:()=>C("frappe_deep_agents.api.list_agents"),listSessions:(s=null,o=null)=>C("frappe_deep_agents.api.list_sessions",{agent_definition:s,status:o}),updateTodo:(s,o)=>C("frappe_deep_agents.api.update_todo",{todo_name:s,status:o}),getFileContent:s=>C("frappe_deep_agents.api.get_file_content",{file_name:s}),exportAgentYaml:s=>C("frappe_deep_agents.api.export_agent_yaml",{agent_definition:s}),importAgentYaml:s=>C("frappe_deep_agents.api.import_agent_yaml",{yaml_content:s})},je={class:"session-sidebar flex flex-col h-full bg-gray-50 border-r border-gray-200"},Te={class:"p-3 border-b border-gray-200"},Le={class:"p-3 border-b border-gray-200"},Ie={class:"relative"},Ne={class:"flex-1 overflow-y-auto"},Be={key:0,class:"p-4 text-center text-gray-500 text-sm"},Fe=["onClick"],De={class:"flex items-start justify-between"},He={class:"flex-1 min-w-0"},Oe={class:"font-medium text-sm truncate text-gray-900"},ze={class:"text-xs text-gray-500 mt-1 flex items-center space-x-2"},Ve={__name:"SessionSidebar",props:{sessions:{type:Array,default:()=>[]},currentSession:{type:Object,default:null}},emits:["new-session","select-session"],setup(s){const o=s,u=h(""),i=j(()=>{if(!u.value)return o.sessions;const f=u.value.toLowerCase();return o.sessions.filter(r=>{const n=(r.agent_definition||"").toLowerCase(),m=(r.name||"").toLowerCase();return n.includes(f)||m.includes(f)})}),a=f=>o.currentSession&&o.currentSession.name===f.name,g=f=>{if(!f)return"";const r=new Date(f),m=new Date-r,$=Math.floor(m/6e4),B=Math.floor(m/36e5),L=Math.floor(m/864e5);return $<1?"Just now":$<60?`${$}m ago`:B<24?`${B}h ago`:L<7?`${L}d ago`:r.toLocaleDateString("en-US",{month:"short",day:"numeric"})},d=f=>({active:"Active",completed:"Done",error:"Error",timeout:"Timeout"})[f?.toLowerCase()]||f||"Active",v=f=>({active:"green",completed:"blue",error:"red",timeout:"orange"})[f?.toLowerCase()]||"gray";return(f,r)=>(l(),c("div",je,[e("div",Te,[_(S(U),{variant:"solid",onClick:r[0]||(r[0]=n=>f.$emit("new-session")),class:"w-full"},{prefix:M(()=>[...r[2]||(r[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])]),default:M(()=>[r[3]||(r[3]=A(" New Chat ",-1))]),_:1})]),e("div",Le,[e("div",Ie,[r[4]||(r[4]=e("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),K(e("input",{"onUpdate:modelValue":r[1]||(r[1]=n=>u.value=n),placeholder:"Search sessions...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white"},null,512),[[se,u.value]])])]),e("div",Ne,[i.value.length===0?(l(),c("div",Be,y(u.value?"No sessions found":"No sessions yet"),1)):x("",!0),(l(!0),c(I,null,N(i.value,n=>(l(),c("div",{key:n.name,class:w(["session-item p-3 cursor-pointer hover:bg-gray-100 transition-colors border-b border-gray-100",a(n)?"bg-blue-50 border-l-4 border-l-blue-500":"border-l-4 border-l-transparent"]),onClick:m=>f.$emit("select-session",n.name)},[e("div",De,[e("div",He,[e("div",Oe,y(n.agent_definition||"Agent Session"),1),e("div",ze,[e("span",null,y(g(n.creation)),1)])]),_(S(J),{label:d(n.status),theme:v(n.status),size:"sm"},null,8,["label","theme"])])],10,Fe))),128))])]))}},Ee=P(Ve,[["__scopeId","data-v-ed06ff8e"]]),Pe={class:"message-role text-xs font-semibold mb-1 opacity-75"},Ue=["innerHTML"],Je={key:0,class:"typing-indicator mt-2"},We={key:1,class:"text-xs opacity-50 mt-2"},Re={__name:"ChatMessage",props:{message:{type:Object,required:!0}},setup(s){F.registerLanguage("javascript",ve),F.registerLanguage("python",he),F.registerLanguage("bash",ye),F.registerLanguage("json",xe);const o=s;te.setOptions({breaks:!0,gfm:!0,highlight:function(d,v){if(v&&F.getLanguage(v))try{return F.highlight(d,{language:v}).value}catch(f){console.error("Highlight error:",f)}return d}});const u=j(()=>{if(!o.message.content)return"";try{return te.parse(o.message.content)}catch(d){return console.error("Markdown parse error:",d),o.message.content.replace(/\n/g,"<br>")}}),i=j(()=>{const d=o.message.role;return{"bg-blue-500 text-white":d==="user","bg-gray-100 text-gray-900":d==="assistant","bg-yellow-50 text-yellow-900 border border-yellow-200":d==="system","bg-purple-50 text-purple-900 border border-purple-200":d==="tool"}}),a=d=>({user:"You",assistant:"Agent",system:"System",tool:"Tool"})[d]||d,g=d=>d?new Date(d).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"";return(d,v)=>(l(),c("div",{class:w(["message-wrapper flex",s.message.role==="user"?"justify-end":"justify-start"])},[e("div",{class:w(["message max-w-2xl rounded-2xl px-4 py-3 shadow-sm",i.value])},[e("div",Pe,y(a(s.message.role)),1),e("div",{class:"prose prose-sm max-w-none",innerHTML:u.value},null,8,Ue),s.message.streaming?(l(),c("div",Je,[...v[0]||(v[0]=[e("span",null,null,-1),e("span",null,null,-1),e("span",null,null,-1)])])):x("",!0),s.message.timestamp?(l(),c("div",We,y(g(s.message.timestamp)),1)):x("",!0)],2)],2))}},qe=P(Re,[["__scopeId","data-v-844874b6"]]),Ke={class:"chat-input border-t bg-white p-4"},Ye={class:"max-w-3xl mx-auto"},Ge={class:"flex items-end space-x-3"},Qe=["disabled"],Xe=["disabled"],Ze={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},et={key:1,class:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},tt={key:0,class:"text-xs text-gray-500 mt-2 text-right"},st={__name:"ChatInput",props:{disabled:{type:Boolean,default:!1}},emits:["send"],setup(s,{emit:o}){const u=s,i=o,a=h(""),g=h(null),d=()=>{a.value.trim()&&!u.disabled&&(i("send",a.value.trim()),a.value="",q(()=>f()))},v=r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),d())},f=()=>{const r=g.value;r&&(r.style.height="auto",r.style.height=Math.min(r.scrollHeight,200)+"px")};return(r,n)=>(l(),c("div",Ke,[e("div",Ye,[e("div",Ge,[K(e("textarea",{ref_key:"textareaRef",ref:g,"onUpdate:modelValue":n[0]||(n[0]=m=>a.value=m),disabled:s.disabled,placeholder:"Send a message... (Shift+Enter for new line)",rows:"1",class:"flex-1 resize-none border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",onKeydown:v,onInput:f},null,40,Qe),[[se,a.value]]),e("button",{disabled:s.disabled||!a.value.trim(),onClick:d,class:w(["px-6 py-3 rounded-xl font-medium transition-colors flex items-center justify-center",s.disabled||!a.value.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"])},[s.disabled?(l(),c("svg",et,[...n[2]||(n[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(l(),c("svg",Ze,[...n[1]||(n[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])]))],10,Xe)]),a.value.length>0?(l(),c("div",tt,y(a.value.length)+" characters ",1)):x("",!0)])]))}},ot={class:"chat-interface flex flex-col h-full bg-white"},nt={class:"max-w-3xl mx-auto space-y-4"},at={key:0,class:"h-full flex items-center justify-center min-h-96"},rt={key:1,class:"flex items-center space-x-2 text-gray-500"},lt={__name:"ChatInterface",props:{messages:{type:Array,default:()=>[]},isStreaming:{type:Boolean,default:!1}},emits:["send"],setup(s,{emit:o}){const u=s,i=o,a=h(null),g=j(()=>{if(u.messages.length===0)return!1;const f=u.messages[u.messages.length-1];return f&&f.content&&f.content.length>0});Z(()=>u.messages.length,()=>{q(()=>{d()})}),Z(()=>u.messages[u.messages.length-1]?.content,()=>{q(()=>{d()})},{deep:!0});function d(){a.value&&a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"})}function v(f){i("send",f)}return(f,r)=>(l(),c("div",ot,[e("div",{ref_key:"messagesContainer",ref:a,class:"messages-container flex-1 overflow-y-auto px-4 py-6"},[e("div",nt,[s.messages.length===0&&!s.isStreaming?(l(),c("div",at,[...r[0]||(r[0]=[e("div",{class:"text-center"},[e("div",{class:"text-5xl mb-4"},"ðŸ¤–"),e("h2",{class:"text-xl font-semibold text-gray-900 mb-2"},"Start a conversation"),e("p",{class:"text-gray-500"}," Send a message to begin interacting with the agent. ")],-1)])])):x("",!0),(l(!0),c(I,null,N(s.messages,(n,m)=>(l(),E(qe,{key:m,message:n},null,8,["message"]))),128)),s.isStreaming&&!g.value?(l(),c("div",rt,[...r[1]||(r[1]=[be('<div class="typing-indicator flex space-x-1" data-v-e4e12f37><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:0ms;" data-v-e4e12f37></span><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:150ms;" data-v-e4e12f37></span><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:300ms;" data-v-e4e12f37></span></div><span class="text-sm" data-v-e4e12f37>Agent is thinking...</span>',2)])])):x("",!0)])],512),_(st,{disabled:s.isStreaming,onSend:v},null,8,["disabled"])]))}},it=P(lt,[["__scopeId","data-v-e4e12f37"]]),ct={class:"agent-status flex items-center space-x-2 text-sm"},ut={class:"text-gray-600"},dt={__name:"AgentStatusIndicator",props:{status:{type:String,default:"idle"}},setup(s){const o=s,u=j(()=>["running","streaming","thinking"].includes(o.status)),i=j(()=>({idle:"bg-gray-400",running:"bg-blue-500",streaming:"bg-green-500",thinking:"bg-purple-500",error:"bg-red-500",completed:"bg-green-500"})[o.status]||"bg-gray-400"),a=j(()=>({idle:"Waiting for input",running:"Processing...",streaming:"Generating response...",thinking:"Thinking...",error:"Error occurred",completed:"Ready"})[o.status]||"Unknown status");return(g,d)=>(l(),c("div",ct,[e("div",{class:w(["w-2 h-2 rounded-full",i.value,{"animate-pulse":u.value}])},null,2),e("span",ut,y(a.value),1)]))}},gt={class:"flex items-start justify-between"},mt={class:"flex items-start space-x-2 flex-1"},pt={key:0,class:"animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ft={key:1,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},vt={key:2,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ht={key:3,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},yt={class:"flex-1 min-w-0"},xt={class:"font-medium text-sm truncate"},bt={class:"text-xs text-gray-500 mt-0.5"},_t={key:0,class:"mt-3 pt-3 border-t space-y-2"},kt={key:0},wt={class:"text-xs bg-gray-50 p-2 rounded overflow-x-auto border border-gray-200 max-h-40"},$t={key:1},Ct={class:"text-xs bg-gray-50 p-2 rounded overflow-x-auto border border-gray-200 max-h-40"},St={key:2,class:"bg-red-50 p-2 rounded border border-red-200"},Mt={class:"text-xs text-red-700 whitespace-pre-wrap"},At={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(s){const o=s,u=h(!1),i=()=>{u.value=!u.value},a={"border-blue-200 bg-blue-50":o.toolCall.status==="running","border-green-200 bg-green-50":o.toolCall.status==="success","border-red-200 bg-red-50":o.toolCall.status==="error","border-gray-200 bg-white":o.toolCall.status==="pending"},g={"text-blue-500":o.toolCall.status==="running","text-green-500":o.toolCall.status==="success","text-red-500":o.toolCall.status==="error","text-gray-400":o.toolCall.status==="pending"},d=r=>r?new Date(r).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",v=r=>{if(typeof r=="string")try{return JSON.stringify(JSON.parse(r),null,2)}catch{return r}else if(typeof r=="object")return JSON.stringify(r,null,2);return String(r)},f=r=>{const n=v(r);return n.length>500?n.substring(0,500)+`
... (truncated)`:n};return(r,n)=>(l(),c("div",{class:w(["tool-call-card border rounded-lg p-3 cursor-pointer transition-all",a]),onClick:i},[e("div",gt,[e("div",mt,[e("div",{class:w(["w-5 h-5 mt-0.5 flex-shrink-0",g])},[s.toolCall.status==="running"?(l(),c("svg",pt,[...n[0]||(n[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):s.toolCall.status==="success"?(l(),c("svg",ft,[...n[1]||(n[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):s.toolCall.status==="error"?(l(),c("svg",vt,[...n[2]||(n[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):(l(),c("svg",ht,[...n[3]||(n[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])]))],2),e("div",yt,[e("div",xt,y(s.toolCall.tool_name),1),e("div",bt,y(d(s.toolCall.timestamp)),1)])]),(l(),c("svg",{class:w(["w-4 h-4 text-gray-400 transform transition-transform flex-shrink-0 ml-2",{"rotate-180":u.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...n[4]||(n[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),u.value?(l(),c("div",_t,[s.toolCall.input?(l(),c("div",kt,[n[5]||(n[5]=e("div",{class:"text-xs font-medium text-gray-600 mb-1"},"Input",-1)),e("pre",wt,y(v(s.toolCall.input)),1)])):x("",!0),s.toolCall.output?(l(),c("div",$t,[n[6]||(n[6]=e("div",{class:"text-xs font-medium text-gray-600 mb-1"},"Output",-1)),e("pre",Ct,y(f(s.toolCall.output)),1)])):x("",!0),s.toolCall.error?(l(),c("div",St,[n[7]||(n[7]=e("div",{class:"text-xs font-medium text-red-600 mb-1"},"Error",-1)),e("pre",Mt,y(s.toolCall.error),1)])):x("",!0)])):x("",!0)],2))}},jt={class:"agent-file-list"},Tt={key:0,class:"text-center text-gray-500 text-sm py-8"},Lt={key:1,class:"space-y-2"},It=["onClick"],Nt={class:"text-xl mr-3"},Bt={class:"flex-1 min-w-0"},Ft={class:"font-medium text-sm truncate text-gray-900"},Dt={class:"text-xs text-gray-500 truncate"},Ht={__name:"AgentFileList",props:{files:{type:Array,default:()=>[]}},emits:["preview"],setup(s){const o=i=>{if(!i)return"Unknown";const a=i.split("/");return a[a.length-1]},u=i=>{const a=i||"",g=a.includes(".")?a.split(".").pop().toLowerCase():"";return{py:"ðŸ",python:"ðŸ",js:"ðŸ“œ",javascript:"ðŸ“œ",ts:"ðŸ“˜",typescript:"ðŸ“˜",vue:"ðŸ’š",json:"ðŸ“‹",md:"ðŸ“",markdown:"ðŸ“",txt:"ðŸ“„",text:"ðŸ“„",png:"ðŸ–¼ï¸",jpg:"ðŸ–¼ï¸",jpeg:"ðŸ–¼ï¸",gif:"ðŸ–¼ï¸",svg:"ðŸŽ¨",pdf:"ðŸ“•",html:"ðŸŒ",css:"ðŸŽ¨",yaml:"âš™ï¸",yml:"âš™ï¸",xml:"ðŸ“°",csv:"ðŸ“Š",sql:"ðŸ—„ï¸",sh:"ðŸ’»",bash:"ðŸ’»",dockerfile:"ðŸ³",docker:"ðŸ³"}[g]||"ðŸ“„"};return(i,a)=>(l(),c("div",jt,[s.files.length?(l(),c("div",Lt,[(l(!0),c(I,null,N(s.files,g=>(l(),c("div",{key:g.name,class:"file-item flex items-center p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors border border-gray-200",onClick:d=>i.$emit("preview",g)},[e("div",Nt,y(u(g.file_path||g.name)),1),e("div",Bt,[e("div",Ft,y(o(g.file_path||g.name)),1),e("div",Dt,y(g.file_path||g.name),1)])],8,It))),128))])):(l(),c("div",Tt,[...a[0]||(a[0]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1),A(" No files created yet ",-1)])]))]))}},Ot={class:"activity-sidebar flex flex-col h-full bg-white border-l border-gray-200"},zt={class:"p-4 border-b border-gray-200"},Vt={class:"border-b border-gray-200"},Et={class:"flex space-x-1 px-4"},Pt=["onClick"],Ut={class:"flex-1 overflow-y-auto p-4"},Jt={key:0},Wt={key:0,class:"text-center text-gray-500 text-sm py-8"},Rt={key:1,class:"space-y-3"},qt={key:1},Kt={key:0,class:"text-center text-gray-500 text-sm py-8"},Yt={key:2},Gt={key:0,class:"text-center text-gray-500 text-sm py-8"},Qt={key:1,class:"space-y-2"},Xt={class:"flex items-start space-x-3"},Zt={key:0,class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},es={key:1,class:"w-2 h-2 bg-white rounded-full animate-pulse"},ts={class:"flex-1 min-w-0"},ss={class:"text-xs text-gray-500 mt-1"},os={__name:"ActivitySidebar",props:{toolCalls:{type:Array,default:()=>[]},files:{type:Array,default:()=>[]},todos:{type:Array,default:()=>[]},agentStatus:{type:String,default:"idle"}},emits:["preview-file"],setup(s,{emit:o}){const u=s,i=o,a=h("tools"),g=j(()=>[{key:"tools",label:"Tools",count:u.toolCalls.length},{key:"files",label:"Files",count:u.files.length},{key:"todos",label:"Todos",count:u.todos.filter(r=>r.status!=="completed").length}]),d=r=>{i("preview-file",r)},v=r=>({pending:"Pending",in_progress:"In Progress",completed:"Completed"})[r]||r,f=r=>({pending:"gray",in_progress:"blue",completed:"green"})[r]||"gray";return(r,n)=>(l(),c("div",Ot,[e("div",zt,[n[0]||(n[0]=e("h3",{class:"font-semibold text-base text-gray-900"},"Agent Activity",-1)),_(dt,{status:s.agentStatus,class:"mt-2"},null,8,["status"])]),e("div",Vt,[e("div",Et,[(l(!0),c(I,null,N(g.value,m=>(l(),c("button",{key:m.key,class:w(["py-2.5 px-3 border-b-2 font-medium text-sm transition-colors",a.value===m.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"]),onClick:$=>a.value=m.key},[A(y(m.label)+" ",1),m.count>0?(l(),E(S(J),{key:0,label:String(m.count),theme:a.value===m.key?"blue":"gray",size:"sm",class:"ml-1.5"},null,8,["label","theme"])):x("",!0)],10,Pt))),128))])]),e("div",Ut,[a.value==="tools"?(l(),c("div",Jt,[s.toolCalls.length===0?(l(),c("div",Wt,[...n[1]||(n[1]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1),A(" No tool calls yet ",-1)])])):(l(),c("div",Rt,[(l(!0),c(I,null,N(s.toolCalls,(m,$)=>(l(),E(At,{key:m.id||$,"tool-call":m},null,8,["tool-call"]))),128))]))])):x("",!0),a.value==="files"?(l(),c("div",qt,[s.files.length===0?(l(),c("div",Kt,[...n[2]||(n[2]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1),A(" No files created yet ",-1)])])):(l(),E(Ht,{key:1,files:s.files,onPreview:d},null,8,["files"]))])):x("",!0),a.value==="todos"?(l(),c("div",Yt,[s.todos.length===0?(l(),c("div",Gt,[...n[3]||(n[3]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})],-1),A(" No todos yet ",-1)])])):(l(),c("div",Qt,[(l(!0),c(I,null,N(s.todos,m=>(l(),c("div",{key:m.name,class:"todo-item p-3 rounded-lg border border-gray-200 bg-white hover:bg-gray-50 transition-colors"},[e("div",Xt,[e("div",{class:w(["w-5 h-5 rounded flex items-center justify-center flex-shrink-0 mt-0.5",m.status==="completed"?"bg-green-500":m.status==="in_progress"?"bg-blue-500":"border-2 border-gray-300"])},[m.status==="completed"?(l(),c("svg",Zt,[...n[4]||(n[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"},null,-1)])])):m.status==="in_progress"?(l(),c("div",es)):x("",!0)],2),e("div",ts,[e("div",{class:w(["text-sm",m.status==="completed"?"line-through text-gray-500":"text-gray-900"])},y(m.description||m.content),3),e("div",ss,[_(S(J),{label:v(m.status),theme:f(m.status),size:"sm"},null,8,["label","theme"])])])])]))),128))]))])):x("",!0)])]))}},ns=P(os,[["__scopeId","data-v-ce009bf6"]]);class as{constructor(){this.socket=null,this.connected=!1,this.eventHandlers=new Map}connect(){if(this.socket&&this.connected)return this.socket;const o=window.frappe?.socketio_port||9e3,u=window.location.hostname;return this.socket=Ae(`${window.location.protocol}//${u}:${o}`,{withCredentials:!0,reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:10,timeout:2e4}),this.socket.on("connect",()=>{this.connected=!0,console.log("Socket.IO connected")}),this.socket.on("disconnect",i=>{this.connected=!1,console.log("Socket.IO disconnected:",i)}),this.socket.on("connect_error",i=>{console.error("Socket.IO connection error:",i)}),this.socket.on("reconnect",i=>{console.log("Socket.IO reconnected after",i,"attempts")}),this.socket}subscribe(o){this.socket||this.connect(),this.socket.emit("subscribe",o),console.log("Subscribed to channel:",o)}unsubscribe(o){this.socket&&(this.socket.emit("unsubscribe",o),console.log("Unsubscribed from channel:",o),this.eventHandlers.delete(o))}on(o,u){this.socket||this.connect(),this.socket.on(o,u)}off(o,u){this.socket&&(u?this.socket.off(o,u):this.socket.off(o))}removeAllListeners(o){this.socket&&this.socket.removeAllListeners(o)}emit(o,u){this.socket||this.connect(),this.socket.emit(o,u)}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.connected=!1,this.eventHandlers.clear())}isConnected(){return this.connected&&this.socket?.connected}}const k=new as,rs={class:"agent-workspace h-screen flex flex-col overflow-hidden bg-gray-50"},ls={class:"h-12 bg-white border-b border-gray-200 flex items-center px-4 flex-shrink-0"},is={class:"flex items-center space-x-4"},cs=["title"],us={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ds={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},gs={class:"flex-1 flex justify-center"},ms={key:0,class:"flex items-center space-x-2 text-sm"},ps={class:"text-gray-600"},fs={class:"flex items-center space-x-2"},vs={class:"flex flex-1 overflow-hidden"},hs={class:"flex-1 flex flex-col min-w-0 bg-white"},ys={key:0,class:"file-viewer"},xs={class:"bg-gray-50 p-4 rounded-lg overflow-x-auto max-h-96 text-sm"},bs={class:"space-y-4"},_s=["value"],ks={key:0,class:"text-sm text-gray-600 mt-2"},ws={__name:"AgentWorkspace",props:{sessionId:String},setup(s){const o=s,u=ke(),i=h(null),a=h([]),g=h([]),d=h([]),v=h([]),f=h([]),r=h([]),n=h(!1),m=h("idle"),$=h(!1),B=h(null),L=h(""),Y=h(!1),H=h(!1),O=h(!1),T=h(""),z=h(!1),G=j(()=>T.value?g.value.find(p=>p.name===T.value):null),re=p=>({active:"green",Active:"green",completed:"blue",error:"red",timeout:"orange"})[p]||"gray",le=()=>{window.location.href="/app"};oe(async()=>{await Promise.all([Q(),ie()]),o.sessionId&&(await W(o.sessionId),R())}),ne(()=>{if(i.value){const p=`agent_session_${i.value.name}`;k.unsubscribe(p)}});async function Q(){try{const p=await D.listSessions();a.value=p||[],a.value.sort((t,b)=>new Date(b.creation)-new Date(t.creation))}catch(p){console.error("Failed to load sessions:",p),a.value=[]}}async function ie(){try{g.value=await D.listAgents()}catch(p){console.error("Failed to load agents:",p),g.value=[]}}async function W(p){Y.value=!0;try{const t=await D.getSession(p);i.value=t,d.value=t.messages||[],v.value=t.todos||[],f.value=t.files||[],r.value=t.tool_calls||[],m.value=t.status==="active"?"idle":t.status}catch(t){console.error("Failed to load session:",t),m.value="error"}finally{Y.value=!1}}function R(){if(!i.value)return;const p=`agent_session_${i.value.name}`;k.subscribe(p),k.on("agent_token",t=>{t.session===i.value.name&&(m.value="streaming",ue(t.token))}),k.on("tool_call_start",t=>{t.session===i.value.name&&(m.value="running",r.value.push({id:Date.now().toString(),tool_name:t.tool_name,input:t.input,status:"running",timestamp:new Date}))}),k.on("tool_call_complete",t=>{if(t.session===i.value.name){const b=r.value.find(X=>X.tool_name===t.tool_name&&X.status==="running");b&&(b.status=t.success?"success":"error",b.output=t.output)}}),k.on("agent_status",t=>{t.session===i.value.name&&(m.value=t.status)}),k.on("todo_update",t=>{t.session===i.value.name&&(v.value=t.todos)}),k.on("file_update",t=>{t.session===i.value.name&&(f.value=t.files)}),k.on("agent_complete",t=>{t.session===i.value.name&&(n.value=!1,m.value="completed",de())}),k.on("agent_error",t=>{t.session===i.value.name&&(n.value=!1,m.value="error",console.error("Agent error:",t.error),d.value.push({role:"system",content:`Error: ${t.error}`}))})}async function ce(p){if(!(!p.trim()||n.value||!i.value)){d.value.push({role:"user",content:p,timestamp:new Date}),d.value.push({role:"assistant",content:"",streaming:!0}),n.value=!0,m.value="thinking";try{await D.sendMessage(i.value.name,p)}catch(t){n.value=!1,m.value="error",console.error("Failed to send message:",t),d.value.push({role:"system",content:`Error: ${t.message||"Failed to send message"}`})}}}function ue(p){const t=d.value[d.value.length-1];t&&t.streaming&&(t.content+=p)}function de(){const p=d.value[d.value.length-1];p&&(p.streaming=!1,p.timestamp=new Date)}async function ge(){O.value=!0}async function me(){if(T.value){z.value=!0;try{const p=await D.createSession(T.value);if(O.value=!1,T.value="",i.value){const t=`agent_session_${i.value.name}`;k.unsubscribe(t)}u.push(`/agent/workspace/${p.name}`),await Q(),await W(p.name),R()}catch(p){console.error("Failed to create session:",p)}finally{z.value=!1}}}async function pe(p){if(i.value){const t=`agent_session_${i.value.name}`;k.unsubscribe(t)}d.value=[],r.value=[],f.value=[],v.value=[],u.push(`/agent/workspace/${p}`),await W(p),R()}async function fe(p){B.value=p,$.value=!0,L.value="Loading...";try{const t=await D.getFileContent(p.name);L.value=t||"No content"}catch(t){L.value=p.content||"Failed to load file content",console.error("Failed to load file:",t)}}return(p,t)=>(l(),c("div",rs,[e("header",ls,[e("div",is,[e("button",{onClick:t[0]||(t[0]=b=>H.value=!H.value),class:"p-1.5 rounded hover:bg-gray-100 transition-colors text-gray-600",title:H.value?"Expand sidebar":"Collapse sidebar"},[H.value?(l(),c("svg",ds,[...t[6]||(t[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 5l7 7-7 7M5 5l7 7-7 7"},null,-1)])])):(l(),c("svg",us,[...t[5]||(t[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"},null,-1)])]))],8,cs),t[7]||(t[7]=e("div",{class:"flex items-center space-x-2"},[e("div",{class:"text-lg font-semibold text-gray-900"},"Deep Agents")],-1))]),e("div",gs,[i.value?(l(),c("div",ms,[e("span",ps,y(i.value.agent_definition),1),t[8]||(t[8]=e("span",{class:"text-gray-400"},"|",-1)),_(S(J),{label:i.value.status||"Active",theme:re(i.value.status)},null,8,["label","theme"])])):x("",!0)]),e("div",fs,[_(S(U),{variant:"ghost",size:"sm",onClick:le},{default:M(()=>[...t[9]||(t[9]=[A(" Desk ",-1)])]),_:1})])]),e("div",vs,[_(_e,{name:"slide"},{default:M(()=>[H.value?x("",!0):(l(),E(Ee,{key:0,sessions:a.value,"current-session":i.value,onNewSession:ge,onSelectSession:pe},null,8,["sessions","current-session"]))]),_:1}),e("div",hs,[_(it,{messages:d.value,"is-streaming":n.value,onSend:ce},null,8,["messages","is-streaming"])]),_(ns,{"tool-calls":r.value,files:f.value,todos:v.value,"agent-status":m.value,onPreviewFile:fe},null,8,["tool-calls","files","todos","agent-status"])]),_(S(ee),{modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=b=>$.value=b),options:{title:B.value?.file_path||"File",size:"4xl"}},{"body-content":M(()=>[B.value?(l(),c("div",ys,[e("pre",xs,[e("code",null,y(L.value||"Loading..."),1)])])):x("",!0)]),_:1},8,["modelValue","options"]),_(S(ee),{modelValue:O.value,"onUpdate:modelValue":t[4]||(t[4]=b=>O.value=b),options:{title:"New Agent Session",size:"lg"}},{"body-content":M(()=>[e("div",bs,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Select Agent",-1)),K(e("select",{"onUpdate:modelValue":t[2]||(t[2]=b=>T.value=b),class:"w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},[t[10]||(t[10]=e("option",{value:""},"Choose an agent...",-1)),(l(!0),c(I,null,N(g.value,b=>(l(),c("option",{key:b.name,value:b.name},y(b.agent_name),9,_s))),128))],512),[[we,T.value]]),G.value?(l(),c("p",ks,y(G.value.description||"No description available"),1)):x("",!0)])])]),actions:M(()=>[_(S(U),{variant:"subtle",onClick:t[3]||(t[3]=b=>O.value=!1)},{default:M(()=>[...t[12]||(t[12]=[A("Cancel",-1)])]),_:1}),_(S(U),{variant:"solid",onClick:me,disabled:!T.value||z.value,loading:z.value},{default:M(()=>[A(y(z.value?"Creating...":"Create Session"),1)]),_:1},8,["disabled","loading"])]),_:1},8,["modelValue"])]))}},V=P(ws,[["__scopeId","data-v-51e8410a"]]),$s=[{path:"/app/agent-chat",name:"Home",component:V},{path:"/app/agent-chat/:sessionId",name:"WorkspaceWithSession",component:V,props:!0},{path:"/agent",name:"AgentHome",component:V},{path:"/agent/workspace",name:"Workspace",component:V},{path:"/agent/workspace/:sessionId",name:"WorkspaceSession",component:V,props:!0},{path:"/:pathMatch(.*)*",redirect:"/app/agent-chat"}],Cs=$e({history:Ce(),routes:$s}),Ss={id:"app",class:"h-screen w-screen bg-gray-50"},Ms={__name:"App",setup(s){return oe(()=>{k.connect(),window.frappe?.csrf_token||fetch("/api/method/frappe.auth.get_logged_user").then(o=>o.json()).catch(console.error)}),ne(()=>{k.disconnect()}),(o,u)=>{const i=Se("router-view");return l(),c("div",Ss,[_(i)])}}},ae=Me(Ms);ae.use(Cs);window.frappe=window.frappe||{};const As=document.getElementById("agent-chat-app")?"#agent-chat-app":"#app";ae.mount(As);
